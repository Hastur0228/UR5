# UR5 实际应用示例

## 实际应用示例

### 1. 视觉系统集成

```urscript
# 与视觉系统通信获取目标位置
def get_vision_target():
    # 连接视觉服务器
    vision_socket = socket_open("192.168.1.200", 8080)
    
    if vision_socket:
        # 请求目标位置
        socket_send_string("GET_TARGET_POSE", vision_socket)
        
        # 接收位置数据 (x, y, z, rx, ry, rz)
        pose_data = socket_read_ascii_float(6, vision_socket, 5.0)
        
        if pose_data[0] == 6:  # 检查接收到的数据个数
            target_pose = p[pose_data[1], pose_data[2], pose_data[3], 
                           pose_data[4], pose_data[5], pose_data[6]]
            
            # 移动到目标位置
            movel(target_pose, a=1.2, v=0.3)
            
            textmsg("已移动到视觉目标位置")
        else:
            textmsg("视觉数据接收错误")
        end
        
        socket_close(vision_socket)
    else:
        textmsg("无法连接视觉系统")
    end
end
```

### 2. PLC通信示例

```urscript
# 与PLC系统通信
def communicate_with_plc():
    plc_ip = "192.168.1.50"
    plc_port = 502  # Modbus TCP端口
    
    plc_socket = socket_open(plc_ip, plc_port)
    
    if plc_socket:
        # 发送启动信号
        socket_send_string("START_CYCLE", plc_socket)
        
        # 等待PLC响应
        response = socket_read_string(plc_socket, 3.0)
        
        if response == "READY":
            textmsg("PLC已准备就绪")
            return True
        else:
            textmsg("PLC响应异常")
            return False
        end
        
        socket_close(plc_socket)
    else:
        textmsg("无法连接PLC")
        return False
    end
end
```

### 3. 数据记录系统

```urscript
# 实时数据记录
thread data_logger():
    log_socket = socket_open("192.168.1.300", 9999)
    
    while True:
        # 获取当前状态
        current_pose = get_actual_tcp_pose()
        current_force = get_tcp_force()
        timestamp = get_system_time()
        
        # 构建数据包
        log_data = str(timestamp) + "," + str(current_pose) + "," + str(current_force)
        
        # 发送到日志服务器
        socket_send_line(log_data, log_socket)
        
        sleep(0.1)  # 10Hz记录频率
    end
end
```

### 4. 远程监控界面

```python
# Python端监控程序
import socket
import threading
import json

class URMonitor:
    def __init__(self, robot_ip):
        self.robot_ip = robot_ip
        self.monitoring = False
        
    def start_monitoring(self):
        self.monitoring = True
        monitor_thread = threading.Thread(target=self._monitor_loop)
        monitor_thread.start()
        
    def _monitor_loop(self):
        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        s.connect((self.robot_ip, 30003))
        
        while self.monitoring:
            try:
                data = s.recv(1024)
                robot_state = self._parse_state_data(data)
                self._update_display(robot_state)
            except Exception as e:
                print(f"监控错误: {e}")
                break
                
        s.close()
        
    def _parse_state_data(self, data):
        # 解析机器人状态数据
        return {"timestamp": time.time(), "data_length": len(data)}
        
    def _update_display(self, state):
        print(f"机器人状态: {state}")

# 使用示例
monitor = URMonitor("192.168.1.100")
monitor.start_monitoring()
```